"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[989],{8989:(G,u,l)=>{l.r(u),l.d(u,{default:()=>S});var m=l(2389),d=l(177),t=l(3953),h=l(584),g=l(7004),p=l(3525),c=l(4341),f=l(3413);const C=["customerDetailModal"];function D(n,o){1&n&&(t.j41(0,"div",11)(1,"div",12)(2,"p"),t.EFF(3,"Loading..."),t.k0s()()())}function F(n,o){1&n&&(t.j41(0,"div",11)(1,"div",12)(2,"p"),t.EFF(3,"Loading..."),t.k0s()()())}function P(n,o){if(1&n){const e=t.RV6();t.j41(0,"tr",18),t.bIt("click",function(){const s=t.eBV(e),i=s.$implicit,_=s.index,r=t.XpG(2);return t.Njj(r.openCustomerDetailModal(i,_))}),t.j41(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"currency"),t.k0s()()}if(2&n){const e=o.$implicit,a=o.index,s=t.XpG(2);t.AVh("selected",a===s.clickedRowIndex),t.R7$(2),t.JRh(e.custname),t.R7$(2),t.JRh(e.custadd),t.R7$(2),t.JRh(e.custemail),t.R7$(2),t.JRh(e.custcontnum),t.R7$(2),t.JRh(t.brH(11,7,e.custbalance,"PHP",!0))}}function b(n,o){1&n&&(t.j41(0,"tr")(1,"td",19),t.EFF(2,"No customers available"),t.k0s()())}function j(n,o){if(1&n&&(t.j41(0,"div",13)(1,"table",14)(2,"thead")(3,"tr",15)(4,"th"),t.EFF(5,"Customer Name"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Address"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Gas"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Contact Number"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Balance"),t.k0s()()(),t.j41(14,"tbody"),t.DNE(15,P,12,11,"tr",16)(16,b,3,0,"tr",17),t.k0s()()()),2&n){const e=t.XpG();t.R7$(15),t.Y8G("ngForOf",e.displayedCustomers),t.R7$(),t.Y8G("ngIf",0===e.displayedCustomers.length)}}function v(n,o){if(1&n){const e=t.RV6();t.j41(0,"div",20)(1,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.goToPage(s.currentPage-1))}),t.EFF(2,"Previous"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s(),t.j41(5,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.goToPage(s.currentPage+1))}),t.EFF(6,"Next"),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(),t.Y8G("disabled",1===e.currentPage),t.R7$(3),t.Lme("Page ",e.currentPage," of ",e.totalPages,""),t.R7$(),t.Y8G("disabled",e.currentPage===e.totalPages)}}function k(n,o){1&n&&(t.j41(0,"div",29)(1,"div",30)(2,"span",31),t.EFF(3,"Loading..."),t.k0s()()())}function T(n,o){if(1&n){const e=t.RV6();t.j41(0,"div",32)(1,"div",33)(2,"label",34),t.EFF(3,"Start Date:"),t.k0s(),t.j41(4,"input",35),t.mxI("ngModelChange",function(s){t.eBV(e);const i=t.XpG(2);return t.DH7(i.startDate,s)||(i.startDate=s),t.Njj(s)}),t.bIt("change",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.applyDateFilter())}),t.k0s()(),t.j41(5,"div",33)(6,"label",36),t.EFF(7,"End Date:"),t.k0s(),t.j41(8,"input",37),t.mxI("ngModelChange",function(s){t.eBV(e);const i=t.XpG(2);return t.DH7(i.endDate,s)||(i.endDate=s),t.Njj(s)}),t.bIt("change",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.applyDateFilter())}),t.k0s()(),t.j41(9,"div",38)(10,"button",39),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.showAllTransactions())}),t.EFF(11,"Show All"),t.k0s()()()}if(2&n){const e=t.XpG(2);t.R7$(4),t.R50("ngModel",e.startDate),t.R7$(4),t.R50("ngModel",e.endDate)}}function E(n,o){1&n&&(t.j41(0,"div"),t.EFF(1,"No transactions available"),t.k0s())}function R(n,o){if(1&n&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"currency"),t.k0s(),t.j41(12,"td"),t.EFF(13),t.nI1(14,"currency"),t.k0s(),t.j41(15,"td"),t.EFF(16),t.k0s(),t.j41(17,"td"),t.EFF(18),t.k0s()()),2&n){const e=o.$implicit,a=t.XpG(4);t.R7$(2),t.JRh(a.formatDate(e.salesdate)),t.R7$(2),t.JRh(e.salesrefnum),t.R7$(2),t.JRh(e.salescat),t.R7$(2),t.JRh(e.salestotalitem),t.R7$(2),t.JRh(t.i5U(11,8,e.salestotalamount,"PHP")),t.R7$(3),t.JRh(t.i5U(14,11,e.salestender,"PHP")),t.R7$(3),t.JRh(e.salespaym),t.R7$(2),t.JRh(e.salestatus)}}function y(n,o){if(1&n&&(t.j41(0,"table",14)(1,"thead")(2,"tr",15)(3,"th"),t.EFF(4,"Date"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Reference Number"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Category"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Total Items"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Total Amount"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Tendered Amount"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Payment Method"),t.k0s(),t.j41(17,"th"),t.EFF(18,"Remarks"),t.k0s()()(),t.j41(19,"tbody"),t.DNE(20,R,19,14,"tr",41),t.k0s(),t.j41(21,"tfoot")(22,"tr",15)(23,"td",42)(24,"div",43)(25,"span"),t.EFF(26),t.nI1(27,"currency"),t.k0s(),t.j41(28,"span"),t.EFF(29),t.nI1(30,"currency"),t.k0s()()()()()()),2&n){const e=t.XpG(3);t.R7$(20),t.Y8G("ngForOf",e.displayedSalesDetails),t.R7$(6),t.SpI("Balance: ",t.brH(27,3,null==e.selectedItem?null:e.selectedItem.custbalance,"PHP",!0),""),t.R7$(3),t.SpI("Total Transactions: ",t.brH(30,7,e.getTotalTransactions(),"PHP",!0),"")}}function M(n,o){if(1&n){const e=t.RV6();t.j41(0,"div",20)(1,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.goToSalesPage(s.salesCurrentPage-1))}),t.EFF(2,"Previous"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s(),t.j41(5,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.goToSalesPage(s.salesCurrentPage+1))}),t.EFF(6,"Next"),t.k0s()()}if(2&n){const e=t.XpG(3);t.R7$(),t.Y8G("disabled",1===e.salesCurrentPage),t.R7$(3),t.Lme("Page ",e.salesCurrentPage," of ",e.salesTotalPages,""),t.R7$(),t.Y8G("disabled",e.salesCurrentPage===e.salesTotalPages)}}function I(n,o){if(1&n&&(t.j41(0,"div",13),t.DNE(1,E,2,0,"div",17)(2,y,31,11,"table",40)(3,M,7,4,"div",10),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngIf",e.noTransactions),t.R7$(),t.Y8G("ngIf",!e.noTransactions),t.R7$(),t.Y8G("ngIf",!e.noTransactions)}}function x(n,o){if(1&n){const e=t.RV6();t.j41(0,"div",22)(1,"div",23)(2,"h4",24),t.EFF(3,"Customer Sales Transactions"),t.k0s(),t.j41(4,"button",25),t.bIt("click",function(){const s=t.eBV(e).$implicit;return t.Njj(s.dismiss("Cross click"))}),t.k0s()(),t.j41(5,"div",26),t.DNE(6,k,4,0,"div",27)(7,T,12,2,"div",28)(8,I,4,3,"div",9),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(6),t.Y8G("ngIf",e.isLoading),t.R7$(),t.Y8G("ngIf",!e.isLoading),t.R7$(),t.Y8G("ngIf",!e.isLoading)}}let S=(()=>{class n{constructor(e,a,s,i){this.customerService=e,this.salesService=a,this.modalService=s,this.datePipe=i,this.customers=[],this.displayedCustomers=[],this.filteredCustomers=[],this.loading=!1,this.currentPage=1,this.pageSize=10,this.totalPages=1,this.searchTerm="",this.searchCriteria="custname",this.clickedRowIndex=null,this.selectedItem=null,this.modalRef=null,this.customerDetails=[],this.salesDetails=[],this.displayedSalesDetails=[],this.filteredSalesDetails=[],this.salesCurrentPage=1,this.salesPageSize=5,this.salesTotalPages=1,this.noTransactions=!1,this.isLoading=!1,this.startDate="",this.endDate=""}ngOnInit(){this.loadCustomers()}formatDate(e){return this.datePipe.transform(e,"yyyy-MM-dd")||""}loadCustomers(){this.loading=!0,this.customerService.getCustomer().subscribe(e=>{this.customers=e,this.filteredCustomers=this.customers,this.totalPages=Math.ceil(this.filteredCustomers.length/this.pageSize),this.updateDisplayedCustomers(),this.loading=!1},e=>{this.loading=!1,console.error("Error fetching customers",e)})}updateDisplayedCustomers(){const e=(this.currentPage-1)*this.pageSize;this.displayedCustomers=this.filteredCustomers.slice(e,e+this.pageSize)}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e,this.updateDisplayedCustomers())}searchCustomers(){this.filteredCustomers=this.customers.filter(e=>e[this.searchCriteria]?.toLowerCase().includes(this.searchTerm.toLowerCase())),this.totalPages=Math.ceil(this.filteredCustomers.length/this.pageSize),this.currentPage=1,this.updateDisplayedCustomers()}openCustomerDetailModal(e,a){this.clickedRowIndex=a,this.selectedItem=e,this.isLoading=!0,this.modalRef=this.modalService.open(this.customerDetailModal,{centered:!0,size:"lg"}),this.modalRef.result.finally(()=>this.resetSelection()),this.fetchSalesTransactions(e.custid).then(()=>{const s=new Date;this.startDate=this.formatDate(s),this.endDate=this.formatDate(s),this.applyDateFilter()})}fetchSalesTransactions(e){return this.isLoading=!0,new Promise((a,s)=>{this.salesService.getSalesByCustID(e,"").subscribe(i=>{this.salesDetails=i,this.salesTotalPages=Math.ceil(this.salesDetails.length/this.salesPageSize),this.salesCurrentPage=1,this.noTransactions=0===this.salesDetails.length,this.updateSalesDisplayed(),this.isLoading=!1,a()},i=>{this.noTransactions=!0,this.isLoading=!1,console.error("Error fetching sales transactions",i),s(i)})})}updateSalesDisplayed(){const e=(this.salesCurrentPage-1)*this.salesPageSize;this.displayedSalesDetails=this.filteredSalesDetails.slice(e,e+this.salesPageSize)}goToSalesPage(e){e>=1&&e<=this.salesTotalPages&&(this.salesCurrentPage=e,this.updateSalesDisplayed())}applyDateFilter(){if(this.startDate&&this.endDate){const e=new Date(this.startDate),a=new Date(this.endDate);this.filteredSalesDetails=this.salesDetails.filter(s=>{const i=new Date(s.salesdate);return i>=e&&i<=a})}else this.filteredSalesDetails=this.salesDetails;console.log(this.filteredSalesDetails.length),this.noTransactions=0===this.filteredSalesDetails.length,this.salesTotalPages=Math.ceil(this.filteredSalesDetails.length/this.salesPageSize),this.salesCurrentPage=1,this.updateSalesDisplayed()}resetSelection(){this.clickedRowIndex=null,this.selectedItem=null,this.startDate="",this.endDate=""}getTotalTransactions(){return this.filteredSalesDetails.filter(e=>"PAID"===e.salestatus).reduce((e,a)=>e+a.salestotalamount,0)}showAllTransactions(){this.startDate="",this.endDate="",this.filteredSalesDetails=this.salesDetails,this.noTransactions=0===this.filteredSalesDetails.length,this.salesTotalPages=Math.ceil(this.filteredSalesDetails.length/this.salesPageSize),this.salesCurrentPage=1,this.updateSalesDisplayed()}static#t=this.\u0275fac=function(a){return new(a||n)(t.rXU(h.B),t.rXU(g.j),t.rXU(p.Bq),t.rXU(d.vh))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-customers"]],viewQuery:function(a,s){if(1&a&&t.GBs(C,5),2&a){let i;t.mGM(i=t.lsd())&&(s.customerDetailModal=i.first)}},standalone:!0,features:[t.Jv_([d.vh]),t.aNF],decls:15,vars:7,consts:[["customerDetailModal",""],[1,"col-xl-12"],["cardTitle","Customer List","blockClass","table-border-style",3,"options"],["class","loading-overlay",4,"ngIf"],[1,"search-container"],["type","text","placeholder","Search customers...",1,"form-control","search-input",3,"ngModelChange","input","ngModel"],[1,"form-control","search-criteria",3,"ngModelChange","change","ngModel"],["value","custname"],["value","custadd"],["class","table-responsive",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"loading-overlay"],[1,"loading-spinner"],[1,"table-responsive"],[1,"table","table-styling"],[1,"table-primary"],[3,"selected","click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"click"],["colspan","6",1,"text-center"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"btn","btn-dark",3,"click","disabled"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center my-5",4,"ngIf"],["class","row mb-3 align-items-end",4,"ngIf"],[1,"text-center","my-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"row","mb-3","align-items-end"],[1,"col-12","col-md-4"],["for","startDate",1,"form-label"],["type","date","id","startDate",1,"form-control",3,"ngModelChange","change","ngModel"],["for","endDate",1,"form-label"],["type","date","id","endDate",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"col-12","col-md-4","text-end"],[1,"btn","btn-secondary","mt-3","mt-md-0",3,"click"],["class","table table-styling",4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","8"],[1,"d-flex","justify-content-between"]],template:function(a,s){if(1&a){const i=t.RV6();t.j41(0,"div",1)(1,"app-card",2),t.DNE(2,D,4,0,"div",3),t.j41(3,"div",4)(4,"input",5),t.mxI("ngModelChange",function(r){return t.eBV(i),t.DH7(s.searchTerm,r)||(s.searchTerm=r),t.Njj(r)}),t.bIt("input",function(){return t.eBV(i),t.Njj(s.searchCustomers())}),t.k0s(),t.j41(5,"select",6),t.mxI("ngModelChange",function(r){return t.eBV(i),t.DH7(s.searchCriteria,r)||(s.searchCriteria=r),t.Njj(r)}),t.bIt("change",function(){return t.eBV(i),t.Njj(s.searchCustomers())}),t.j41(6,"option",7),t.EFF(7,"Name"),t.k0s(),t.j41(8,"option",8),t.EFF(9,"Address"),t.k0s()()(),t.DNE(10,F,4,0,"div",3)(11,j,17,2,"div",9)(12,v,7,4,"div",10),t.k0s()(),t.DNE(13,x,9,3,"ng-template",null,0,t.C5r)}2&a&&(t.R7$(),t.Y8G("options",!1),t.R7$(),t.Y8G("ngIf",s.loading),t.R7$(2),t.R50("ngModel",s.searchTerm),t.R7$(),t.R50("ngModel",s.searchCriteria),t.R7$(5),t.Y8G("ngIf",s.loading),t.R7$(),t.Y8G("ngIf",!s.loading),t.R7$(),t.Y8G("ngIf",!s.loading&&s.displayedCustomers.length>0))},dependencies:[m.G,d.Sq,d.bT,c.xH,c.y7,c.me,c.wz,c.BC,c.vS,f.i,d.oe],styles:[".search-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px}.search-input[_ngcontent-%COMP%]{flex:1;padding:10px;font-size:16px;border-radius:5px;border:1px solid #ccc;transition:border-color .3s;margin-right:10px}.search-input[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.search-criteria[_ngcontent-%COMP%]{width:150px;padding:10px;font-size:16px;border-radius:5px;border:1px solid #ccc;transition:border-color .3s}.search-criteria[_ngcontent-%COMP%]:focus{border-color:#b0cfee;outline:none}.table-styling[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table-styling[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .3s}.table-styling[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background-color:#d1ecf1;color:#0c5460}.table-styling[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#d8eef1f4;cursor:pointer}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#fffc;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-spinner[_ngcontent-%COMP%]{text-align:center;font-size:16px;color:#333}.loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})}return n})()}}]);